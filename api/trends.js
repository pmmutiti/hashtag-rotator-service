
import axios from 'axios'; import cheerio from 'cheerio'; let cache = {}; const CACHE_TTL = 60 * 60 * 1000; const regionMap = { kenya: 'https://trends24.in/kenya/', usa: 'https://trends24.in/united-states/', uk: 'https://trends24.in/united-kingdom/' }; export default async function handler(req, res) { const region = (req.query.region || 'kenya').toLowerCase(); const url = regionMap[region] || regionMap['kenya']; const now = Date.now(); if (cache[region] && now - cache[region].timestamp < CACHE_TTL) { return res.status(200).json({ hashtags: cache[region].data }); } try { const { data } = await axios.get(url); const $ = cheerio.load(data); const hashtags = []; $('.trend-card .trend-card__list li a').each((i, el) => { if (i < 7) hashtags.push($(el).text()); }); cache[region] = { data: hashtags, timestamp: now }; res.setHeader('Access-Control-Allow-Origin', '*'); res.status(200).json({ hashtags }); } catch (err) { res.status(500).json({ error: 'Failed to fetch hashtags' }); } }
